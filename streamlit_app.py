import os
import openai
import streamlit as st
from dotenv import load_dotenv
from parse_hh import extract_vacancy_data, extract_resume_data
from pdf_resume_parser import extract_resume_data_from_pdf

load_dotenv()

OPENAI_API_KEY=os.environ.get('OPENAI_API_KEY')

client = openai.OpenAI(api_key=OPENAI_API_KEY)

def request_gpt(system_prompt, user_prompt):
    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": system_prompt},  
            {"role": "user", "content": user_prompt},     
        ],
        max_tokens=1000,
        temperature=0,
    )
    return response.choices[0].message.content

# -----------------------------
# CONFIG
# -----------------------------
st.set_page_config(
    page_title="CV Scoring App",
    layout="wide"
)

# -----------------------------
# STYLES
# -----------------------------
st.markdown("""
<style>
/* –û–±—â–∏–π —Ñ–æ–Ω */
.stApp {
    background-color: #f7f8fa;
}

/* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
h1, h2, h3 {
    font-weight: 600;
    color: #1f2937;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∏ */
.card {
    background: #ffffff;
    border-radius: 14px;
    padding: 20px 24px;
    margin-bottom: 20px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.06);
}

/* Primary button */
div.stButton > button {
    background: linear-gradient(135deg, #4f46e5, #6366f1);
    color: white;
    border-radius: 12px;
    padding: 10px 22px;
    font-weight: 600;
    border: none;
}

div.stButton > button:hover {
    background: linear-gradient(135deg, #4338ca, #4f46e5);
    transform: scale(1.02);
}

/* Text areas */
textarea {
    border-radius: 10px !important;
}

/* Result block */
.result-box {
    background: #0f172a;
    color: #e5e7eb;
    padding: 24px;
    border-radius: 14px;
    font-size: 16px;
    line-height: 1.6;
}

/* Divider */
hr {
    border: none;
    height: 1px;
    background: linear-gradient(to right, transparent, #c7d2fe, transparent);
}
</style>
""", unsafe_allow_html=True)

VACANCY_GEN_SYSTEM_PROMPT = """
–¢—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–ø–∏—Å–∞–Ω–∏–π –≤–∞–∫–∞–Ω—Å–∏–π –¥–ª—è –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞.

–í–ê–ñ–ù–û. –¢—ã –û–ë–Ø–ó–ê–ù —Å—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞—Ç—å —à–∞–±–ª–æ–Ω –∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∏–∂–µ.

–ü–†–ê–í–ò–õ–ê:
1. –°–∏–º–≤–æ–ª—ã ### –∏ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ " —è–≤–ª—è—é—Ç—Å—è –°–õ–£–ñ–ï–ë–ù–´–ú–ò –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¢–û–õ–¨–ö–û –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
2. –í –ò–¢–û–ì–û–í–û–ú –†–ï–ó–£–õ–¨–¢–ê–¢–ï —Å–∏–º–≤–æ–ª–æ–≤ ### –∏ " –ë–´–¢–¨ –ù–ï –î–û–õ–ñ–ù–û.
3. –í–µ—Å—å —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤ —à–∞–±–ª–æ–Ω–µ –∑–∞–∫–ª—é—á—ë–Ω –º–µ–∂–¥—É ###, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥—ë–Ω –¥–æ—Å–ª–æ–≤–Ω–æ, –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô, –Ω–æ –ë–ï–ó —Å–∏–º–≤–æ–ª–æ–≤ ###.
4. –í–µ—Å—å —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤ —à–∞–±–ª–æ–Ω–µ –∑–∞–∫–ª—é—á—ë–Ω –≤ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ ", –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Ç–æ–±–æ–π –∏ –≤—ã–≤–µ–¥–µ–Ω –ë–ï–ó –∫–∞–≤—ã—á–µ–∫.
5. –ó–∞–ø—Ä–µ—â–µ–Ω–æ:
   - –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –±–ª–æ–∫–æ–≤
   - –¥–æ–±–∞–≤–ª—è—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å –±–ª–æ–∫–∏
   - –∏–∑–º–µ–Ω—è—Ç—å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
6. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π —Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:
   - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º
   - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏
   - –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–º —Å–æ –≤—Å–µ–º —Ç–µ–∫—Å—Ç–æ–º

–í–µ—Ä–Ω–∏ –¢–û–õ–¨–ö–û –∏—Ç–æ–≥–æ–≤—ã–π —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏. –ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤, –ø–æ—è—Å–Ω–µ–Ω–∏–π –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç —Å–µ–±—è.

–®–ê–ë–õ–û–ù (—Å–ª—É–∂–µ–±–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –ù–ï –≤—ã–≤–æ–¥–∏—Ç—å):

###–ü–ï–†–í–û–£–†–ê–õ–¨–°–ö–ë–ê–ù–ö‚Äî –¥–∏–Ω–∞–º–∏—á–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–π—Å—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∏–Ω—Å—Ç–∏—Ç—É—Ç. –ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –Ω–∞—à–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –ø–µ—Ä–µ–¥–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –º–Ω–æ–≥–æ–ª–µ—Ç–Ω–∏–π –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–º —Ä—ã–Ω–∫–µ. –ú—ã –ø–æ–º–æ–≥–∞–µ–º –Ω–∞—à–∏–º –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º –∏ –∫–ª–∏–µ–Ω—Ç–∞–º —Ä–µ—à–∏—Ç—å –∑–∞–¥–∞—á–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏. –ü—Ä–∏–≥–ª–∞—à–∞–µ–º –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ–≥–æ –∏ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ### "..."

###–ì–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –ø–æ –¥–∞–Ω–Ω–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏:### "..."

###–û–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏:###
"..."

###–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:###
"..."

###–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º:
- –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–º—É –∏ –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ–º—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é –≤ –±–∞–Ω–∫–µ.
- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ –¢–ö –†–§
- –°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ç–∞–±–∏–ª—å–Ω—É—é –æ–ø–ª–∞—Ç—É —Ç—Ä—É–¥–∞, –æ–∫–ª–∞–¥+ –ø—Ä–µ–º–∏–∏ –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º —Ä–∞–±–æ—Ç—ã.
- –ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã 5/2 —Å –≥–∏–±–∫–∏–º –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è —Å 8-00 –¥–æ 10-00
- –ù–∞—à –æ—Ñ–∏—Å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –ë–¶ "–°–∞–≤–µ–ª–æ–≤—Å–∫–∏–π –°–∏—Ç–∏", 5 –º–∏–Ω. –ø–µ—à. –æ—Ç –º. –î–º–∏—Ç—Ä–æ–≤—Å–∫–∞—è, –Ω–µ–¥–∞–ª–µ–∫–æ –æ—Ç –∞–≤–∞–Ω–≥–∞—Ä–¥–Ω–æ–≥–æ –∞—Ä—Ç-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –•–ª–µ–±–∑–∞–≤–æ–¥ ‚Ññ9 –∏ –î–∏–∑–∞–π–Ω-–∑–∞–≤–æ–¥–∞ "–§–ª–∞–∫–æ–Ω".

–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ!? –ó–≤–æ–Ω–∏—Ç–µ! –ü–∏—à–∏—Ç–µ! –û—Ç–∫–ª–∏–∫–∞–π—Ç–µ—Å—å! –í—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –∫ –æ–±—Å—É–∂–¥–µ–Ω–∏—é –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ –∏ –≤–∑–∞–∏–º–æ–≤—ã–≥–æ–¥–Ω–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞! ###
""".strip()

OCR_RESUME_SYSTEM_PROMPT = """
–¢—ã HR-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É —Ä–µ–∑—é–º–µ.

–¢–µ–±–µ –ø–µ—Ä–µ–¥–∞–Ω —Ç–µ–∫—Å—Ç —Ä–µ–∑—é–º–µ, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Å –ø–æ–º–æ—â—å—é OCR.
–¢–µ–∫—Å—Ç –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—à–∏–±–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è, –ø–æ–≤—Ç–æ—Ä—ã —Å—Ç—Ä–æ–∫ –∏ –Ω–∞—Ä—É—à–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞:
- –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–∑—é–º–µ
- –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—á–µ–≤–∏–¥–Ω—ã–µ OCR-–æ—à–∏–±–∫–∏
- –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∫ –ª–æ–≥–∏—á–µ—Å–∫–æ–º—É –∏ —á–∏—Ç–∞–±–µ–ª—å–Ω–æ–º—É –≤–∏–¥—É

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç—Ä–æ–≥–æ –≤ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ Markdown:

# –§–ò–û

**–ü–æ–ª, –≤–æ–∑—Ä–∞—Å—Ç**

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** ...
**–î–æ–ª–∂–Ω–æ—Å—Ç—å:** ...
**–°—Ç–∞—Ç—É—Å:** ...

## –û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã

## –ö–ª—é—á–µ–≤—ã–µ –Ω–∞–≤—ã–∫–∏

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Äî —É–∫–∞–∂–∏ "–ù–µ –Ω–∞–π–¥–µ–Ω–æ".
–ù–µ –¥–æ–±–∞–≤–ª—è–π –Ω–∏—á–µ–≥–æ –æ—Ç —Å–µ–±—è.
""".strip()

SYSTEM_PROMPT = """
–ü—Ä–æ—Å–∫–æ—Ä—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞, –Ω–∞—Å–∫–æ–ª—å–∫–æ –æ–Ω –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–π –≤–∞–∫–∞–Ω—Å–∏–∏.

–°–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏ –∫–æ—Ä–æ—Ç–∫–∏–π –∞–Ω–∞–ª–∏–∑, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ—è—Å–Ω—è—Ç—å –æ—Ü–µ–Ω–∫—É.
–û—Ç–¥–µ–ª—å–Ω–æ –æ—Ü–µ–Ω–∏ –∫–∞—á–µ—Å—Ç–≤–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–µ–∑—é–º–µ (–ø–æ–Ω—è—Ç–Ω–æ –ª–∏, —Å –∫–∞–∫–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏ —Å—Ç–∞–ª–∫–∏–≤–∞–ª—Å—è –∫–∞–Ω–¥–∏–¥–∞—Ç –∏ –∫–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –∏—Ö —Ä–µ—à–∞–ª?). –≠—Ç–∞ –æ—Ü–µ–Ω–∫–∞ –¥–æ–ª–∂–Ω–∞ —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –ø—Ä–∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ - –Ω–∞–º –≤–∞–∂–Ω–æ –Ω–∞–Ω–∏–º–∞—Ç—å —Ç–∞–∫–∏—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ —Å–≤–æ—é —Ä–∞–±–æ—Ç—É
–ü–æ—Ç–æ–º –ø—Ä–µ–¥—Å—Ç–∞–≤—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ –æ—Ü–µ–Ω–∫–∏ –æ—Ç 1 –¥–æ 10.
""".strip()

# UI
# -----------------------------
# HEADER
# -----------------------------
st.title("üß† CV Scoring App")
st.caption("AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤–∞–∫–∞–Ω—Å–∏–∏")

# -----------------------------
# 1Ô∏è‚É£ –í–ê–ö–ê–ù–°–ò–Ø
# -----------------------------
st.markdown('<div class="card">', unsafe_allow_html=True)
st.header("1Ô∏è‚É£ –í–∞–∫–∞–Ω—Å–∏—è")

vac_tab1, vac_tab2, vac_tab3 = st.tabs(
    ["‚úç –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é", "üìÑ –í—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç", "üîó hh.ru"]
)

job_text = None

with vac_tab1:
    vacancy_title = st.text_input("–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏")
    if st.button("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏"):
        if vacancy_title:
            job_text = request_gpt(VACANCY_GEN_SYSTEM_PROMPT, f"–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏: {vacancy_title}")
            st.text_area("–û–ø–∏—Å–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏", job_text, height=300)

with vac_tab2:
    job_text_manual = st.text_area(
        "–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏",
        height=300
    )
    if job_text_manual:
        job_text = job_text_manual

with vac_tab3:
    vacancy_url = st.text_input("–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é hh.ru")
    if vacancy_url:
        try:
            job_text = extract_vacancy_data(vacancy_url)
            st.success("–í–∞–∫–∞–Ω—Å–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å hh.ru")
        except Exception as e:
            st.error(f"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞–∫–∞–Ω—Å–∏–∏: {e}")

st.markdown('</div>', unsafe_allow_html=True)

# -----------------------------
# 2Ô∏è‚É£ –†–ï–ó–Æ–ú–ï
# -----------------------------
st.markdown('<div class="card">', unsafe_allow_html=True)
st.header("2Ô∏è‚É£ –†–µ–∑—é–º–µ")

res_tab1, res_tab2, res_tab3 = st.tabs(
    ["üìé PDF", "üìù –í—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç", "üîó hh.ru"]
)

resume_text = None

with res_tab1:
    uploaded_pdf = st.file_uploader("–ó–∞–≥—Ä—É–∑–∏—Ç–µ PDF —Ä–µ–∑—é–º–µ", type=["pdf"], key="resume_pdf")
    if uploaded_pdf:
        try:
            resume_text = extract_resume_data_from_pdf(uploaded_pdf, system_prompt=OCR_RESUME_SYSTEM_PROMPT)
            st.success("PDF –æ–±—Ä–∞–±–æ—Ç–∞–Ω")
        except Exception as e:
            st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ PDF: {e}")

with res_tab2:
    resume_text_manual = st.text_area("–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Ä–µ–∑—é–º–µ", height=300)
    if resume_text_manual:
        resume_text = resume_text_manual

with res_tab3:
    resume_url = st.text_input("–°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–∑—é–º–µ hh.ru")
    if resume_url:
        try:
            resume_text = extract_resume_data(resume_url)
            st.success("–†–µ–∑—é–º–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ —Å hh.ru")
        except Exception as e:
            st.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ä–µ–∑—é–º–µ: {e}")

st.markdown('</div>', unsafe_allow_html=True)

# -----------------------------
# 3Ô∏è‚É£ –ê–ù–ê–õ–ò–ó
# -----------------------------
st.markdown('<div class="card">', unsafe_allow_html=True)
st.header("3Ô∏è‚É£ –ê–Ω–∞–ª–∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è")

col1, col2, col3 = st.columns([1, 2, 1])
with col2:
    analyze_btn = st.button("‚ñ∂ –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞", use_container_width=True)

if analyze_btn:
    if not job_text or not resume_text:
        st.warning("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é –∏ —Ä–µ–∑—é–º–µ")
        st.stop()

    with st.spinner("–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–∞..."):
        prompt = f"# –í–ê–ö–ê–ù–°–ò–Ø\n{job_text}\n\n# –†–ï–ó–Æ–ú–ï\n{resume_text}"
        result = request_gpt(SYSTEM_PROMPT, prompt)

    st.subheader("üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞")
    st.markdown(f'<div class="result-box">{result.replace("\n", "<br>")}</div>', unsafe_allow_html=True)

st.markdown('</div>', unsafe_allow_html=True)
st.caption("¬© AI HR Assistant")